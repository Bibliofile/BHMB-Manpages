{"version":3,"file":"bundle.js","sources":["../src/index.ts"],"sourcesContent":["import { MessageBot, Player } from '@bhmb/bot'\r\nimport { UIExtensionExports } from '@bhmb/ui'\r\n\r\n// For Safari 9\r\nif (!Object.entries) {\r\n  Object.entries = (obj: any) => Object.keys(obj).reduce((arr, key) => arr.concat([key, obj[key]]), [] as any[])\r\n}\r\n\r\nimport html from './tab.html'\r\n\r\nMessageBot.registerExtension('bibliofile/manpages', ex => {\r\n  const getPages = () => ex.storage.get<{[key: string]: string}>('pages', {})\r\n  const getCommand = () => ex.storage.get('command', '/?').toLocaleUpperCase()\r\n\r\n  function listener({message, player}: {player: Player, message: string}) {\r\n    message = message.trim().toLocaleUpperCase()\r\n    let command = getCommand()\r\n    let pages = getPages()\r\n    if (message == command) {\r\n      // Display listing of all pages\r\n      let toSend = Object.keys(pages).reduce((toSend, key) => {\r\n        return toSend + `\\n${command} ${key}`\r\n      }, 'Topics:')\r\n\r\n      ex.bot.send(toSend)\r\n    } else if (message.startsWith(command)) {\r\n      // Display specific page\r\n\r\n      let page = pages[message.substr(command.length + 1).toLocaleUpperCase()]\r\n      if (!page) {\r\n        ex.bot.send(`Topic not found. Use ${command} to view all topics.`)\r\n        return\r\n      }\r\n\r\n      ex.bot.send(page, { name: player.name })\r\n    }\r\n  }\r\n  ex.world.onMessage.sub(listener)\r\n\r\n  ex.remove = () => ex.world.onMessage.unsub(listener)\r\n\r\n  // Browser only\r\n  const ui = ex.bot.getExports('ui') as UIExtensionExports | undefined\r\n  if (!ui) return\r\n\r\n  const tab = ui.addTab('Man Pages', 'messages')\r\n  tab.innerHTML = html\r\n\r\n  const addPage = (name?: string, content?: string) => {\r\n    let template = tab.querySelector('template') as HTMLTemplateElement\r\n    let pagesDiv = tab.querySelector('.pages') as HTMLDivElement\r\n    ui.buildTemplate(template, pagesDiv, [\r\n      { selector: 'summary', text: name || '' },\r\n      { selector: 'input', value: name || '' },\r\n      { selector: 'textarea', value: content || '' }\r\n    ])\r\n  }\r\n\r\n  Object.entries(getPages())\r\n    .forEach(([name, content]) => addPage(name, content))\r\n\r\n  tab.addEventListener('input', () => {\r\n    // Command\r\n    ex.storage.set('command', (tab.querySelector('input') as HTMLInputElement).value || '/?')\r\n    // Pages\r\n    let pages: {[k: string]: string} = {}\r\n    tab.querySelectorAll('details').forEach(element => {\r\n      let name = (element.querySelector('input') as HTMLInputElement).value\r\n      let content = (element.querySelector('textarea') as HTMLTextAreaElement).value\r\n      ;(element.querySelector('summary') as HTMLElement).textContent = name\r\n      if (name) pages[name.toLocaleUpperCase()] = content\r\n    })\r\n    ex.storage.set('pages', pages)\r\n  })\r\n\r\n  ;(tab.querySelector('.button') as HTMLButtonElement).addEventListener('click', () => addPage())\r\n\r\n  ex.remove = () => {\r\n    ex.world.onMessage.unsub(listener)\r\n    ui.removeTab(tab)\r\n  }\r\n})\r\n"],"names":["MessageBot"],"mappings":";;;;;;;;AAIA,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE;IACnB,MAAM,CAAC,OAAO,GAAG,CAAC,GAAQ,KAAK,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,KAAK,GAAG,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAW,CAAC,CAAA;CAC/G;AAED,AAEAA,cAAU,CAAC,iBAAiB,CAAC,qBAAqB,EAAE,EAAE;IACpD,MAAM,QAAQ,GAAG,MAAM,EAAE,CAAC,OAAO,CAAC,GAAG,CAA0B,OAAO,EAAE,EAAE,CAAC,CAAA;IAC3E,MAAM,UAAU,GAAG,MAAM,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC,iBAAiB,EAAE,CAAA;IAE5E,kBAAkB,EAAC,OAAO,EAAE,MAAM,EAAoC;QACpE,OAAO,GAAG,OAAO,CAAC,IAAI,EAAE,CAAC,iBAAiB,EAAE,CAAA;QAC5C,IAAI,OAAO,GAAG,UAAU,EAAE,CAAA;QAC1B,IAAI,KAAK,GAAG,QAAQ,EAAE,CAAA;QACtB,IAAI,OAAO,IAAI,OAAO,EAAE;;YAEtB,IAAI,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,CAAC,MAAM,EAAE,GAAG;gBACjD,OAAO,MAAM,GAAG,KAAK,OAAO,IAAI,GAAG,EAAE,CAAA;aACtC,EAAE,SAAS,CAAC,CAAA;YAEb,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;SACpB;aAAM,IAAI,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE;;YAGtC,IAAI,IAAI,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,iBAAiB,EAAE,CAAC,CAAA;YACxE,IAAI,CAAC,IAAI,EAAE;gBACT,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,wBAAwB,OAAO,sBAAsB,CAAC,CAAA;gBAClE,OAAM;aACP;YAED,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,CAAC,CAAA;SACzC;KACF;IACD,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;IAEhC,EAAE,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAA;;IAGpD,MAAM,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAmC,CAAA;IACpE,IAAI,CAAC,EAAE;QAAE,OAAM;IAEf,MAAM,GAAG,GAAG,EAAE,CAAC,MAAM,CAAC,WAAW,EAAE,UAAU,CAAC,CAAA;IAC9C,GAAG,CAAC,SAAS,GAAG,IAAI,CAAA;IAEpB,MAAM,OAAO,GAAG,CAAC,IAAa,EAAE,OAAgB;QAC9C,IAAI,QAAQ,GAAG,GAAG,CAAC,aAAa,CAAC,UAAU,CAAwB,CAAA;QACnE,IAAI,QAAQ,GAAG,GAAG,CAAC,aAAa,CAAC,QAAQ,CAAmB,CAAA;QAC5D,EAAE,CAAC,aAAa,CAAC,QAAQ,EAAE,QAAQ,EAAE;YACnC,EAAE,QAAQ,EAAE,SAAS,EAAE,IAAI,EAAE,IAAI,IAAI,EAAE,EAAE;YACzC,EAAE,QAAQ,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,IAAI,EAAE,EAAE;YACxC,EAAE,QAAQ,EAAE,UAAU,EAAE,KAAK,EAAE,OAAO,IAAI,EAAE,EAAE;SAC/C,CAAC,CAAA;KACH,CAAA;IAED,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;SACvB,OAAO,CAAC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,KAAK,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAA;IAEvD,GAAG,CAAC,gBAAgB,CAAC,OAAO,EAAE;;QAE5B,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,EAAG,GAAG,CAAC,aAAa,CAAC,OAAO,CAAsB,CAAC,KAAK,IAAI,IAAI,CAAC,CAAA;;QAEzF,IAAI,KAAK,GAA0B,EAAE,CAAA;QACrC,GAAG,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,OAAO;YAC7C,IAAI,IAAI,GAAI,OAAO,CAAC,aAAa,CAAC,OAAO,CAAsB,CAAC,KAAK,CAAA;YACrE,IAAI,OAAO,GAAI,OAAO,CAAC,aAAa,CAAC,UAAU,CAAyB,CAAC,KAAK,CAC7E;YAAC,OAAO,CAAC,aAAa,CAAC,SAAS,CAAiB,CAAC,WAAW,GAAG,IAAI,CAAA;YACrE,IAAI,IAAI;gBAAE,KAAK,CAAC,IAAI,CAAC,iBAAiB,EAAE,CAAC,GAAG,OAAO,CAAA;SACpD,CAAC,CAAA;QACF,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,CAAA;KAC/B,CAAC,CAED;IAAC,GAAG,CAAC,aAAa,CAAC,SAAS,CAAuB,CAAC,gBAAgB,CAAC,OAAO,EAAE,MAAM,OAAO,EAAE,CAAC,CAAA;IAE/F,EAAE,CAAC,MAAM,GAAG;QACV,EAAE,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAA;QAClC,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,CAAA;KAClB,CAAA;CACF,CAAC,CAAA;;;;;"}